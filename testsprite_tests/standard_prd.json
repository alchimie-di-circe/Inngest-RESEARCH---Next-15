{
  "meta": {
    "project": "TestSprite Phase 2",
    "date": "2026-02-06",
    "prepared_by": "Generated by Jules + Droid"
  },
  "product_overview": "TestSprite Phase 2 is an advanced platform for managing brand profiles and orchestrating deep research workflows. It leverages Next.js 15, TypeScript, Prisma ORM, and Inngest event orchestration to deliver an end-to-end solution including robust APIs, real-time streaming updates, and automated testing infrastructure for high-quality content creation and publishing workflows.",
  "core_goals": [
    "Provide a robust Brand Configuration Management system with CRUD capabilities for comprehensive brand profile customization including tone of voice, colors, and platform history.",
    "Refactor the Deep Research Agent to utilize Inngest checkpointing and real-time streaming to deliver low-latency research workflows with persistence and live progress updates.",
    "Establish a comprehensive REST API layer for managing research jobs, content items, and publishing queues with strict type safety and validation.",
    "Implement a mature testing infrastructure leveraging Jest and Playwright to ensure code reliability, coverage, and parallel development autonomy.",
    "Define unified TypeScript types and rigorous Zod schemas for all domain models and Inngest event payloads to enforce runtime validation and type safety across the system."
  ],
  "key_features": [
    "Brand Configuration Management API with full CRUD endpoints for managing brand details, including tone of voice guidelines, brand colors, logo, and platform history.",
    "Next.js 15 App Router API routes to handle research job lifecycle: creation, retrieval, update, deletion, and lightweight status polling endpoints.",
    "Deep Research Agent Orchestrator implementing Inngest checkpointing and realtime streaming for responsive and persistent multi-step research workflows.",
    "Zod-powered unified schemas for all domain-specific types and Inngest events, providing runtime validation and preventing payload mismatches.",
    "Automated Testing Infrastructure setup including Jest with coverage thresholds, mock utilities for Prisma and Inngest, standardized fixtures, and Playwright for end-to-end testing optimized for CI environments.",
    "Frontend React components using React Hook Form and Tailwind CSS for brand management (BrandForm, BrandList, BrandSelector) and research workflows (ResearchForm, ResearchStatus, ResearchReport).",
    "Inngest realtime channels and middleware integration enabling event-driven capabilities and live progress updates streamed to the UI."
  ],
  "user_flow_summary": [
    "User creates or updates a brand profile via the Brand Configuration Management UI, submitting detailed brand attributes that are validated by Zod and persisted via the Brand API.",
    "User submits a research request through the ResearchForm UI, specifying parameters like topic, depth, breadth, and optional brand context.",
    "The research request triggers the Inngest deep.research.requested event, launching an orchestrated workflow that processes research steps with checkpointing and publishes real-time progress updates via a dedicated research realtime channel.",
    "User subscribes to realtime updates in the ResearchStatus component, observing live progress and messages streamed from the backend without needing to poll.",
    "Upon completion, the full research report is persisted and displayed in the ResearchReport view.",
    "APIs provide interfaces for frontend and external systems to list, create, update, or delete research jobs, content items, and publishing queue entries with appropriate validation and error handling.",
    "Automated tests run continuously covering unit, integration, and end-to-end scenarios using Jest and Playwright to maintain high quality and prevent regressions."
  ],
  "validation_criteria": [
    "All TypeScript code compiles without errors, including updated type definitions and Zod schema validations.",
    "Zod validation schemas cover all domain models and Inngest event payloads with unit tests verifying success and failure cases.",
    "API routes implement strict validation and return appropriate HTTP status codes for success and error scenarios.",
    "Inngest events trigger correctly with checkpointing enabled on orchestrator functions and realtime streaming updates are received and displayed in the UI.",
    "CRUD operations for Brand Configuration Management function end-to-end, including frontend forms with validation and dark mode styling.",
    "Automated test suites run successfully with coverage thresholds met: Jest coverage thresholds of at least 80% globally and 90% in Inngest modules, and Playwright E2E tests pass in CI environments.",
    "Mock utilities for Prisma and Inngest behave correctly in unit tests, supporting isolated test cases for each major domain.",
    "Manual API testing returns expected results and error handling is consistent and clear across all endpoints.",
    "Integration tests confirm the flow between frontend actions, API routes, and backend event orchestration remains intact without regressions."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Next.js 15",
      "React 19",
      "Inngest (Event Orchestration)",
      "Prisma ORM",
      "Neon (PostgreSQL)",
      "Zod (Validation)",
      "Jest (Unit Testing)",
      "Playwright (E2E Testing)",
      "React Hook Form",
      "Tailwind CSS"
    ],
    "features": [
      {
        "name": "Brand Configuration Management API",
        "description": "CRUD endpoints for managing brand profiles including tone of voice, colors, and platform history",
        "files": [
          "src/app/api/brand/route.ts",
          "src/app/api/brand/[id]/route.ts",
          "src/types/brand.ts"
        ],
        "api_doc": {
          "endpoints": [
            {
              "path": "/api/brand",
              "method": "GET",
              "description": "List all brand configurations"
            },
            {
              "path": "/api/brand",
              "method": "POST",
              "description": "Create new brand configuration",
              "requestBody": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "tovGuidelines": {
                    "type": "string"
                  },
                  "brandColors": {
                    "type": "object"
                  },
                  "logoUrl": {
                    "type": "string"
                  }
                }
              }
            },
            {
              "path": "/api/brand/{id}",
              "method": "GET",
              "description": "Get single brand configuration"
            },
            {
              "path": "/api/brand/{id}",
              "method": "PUT",
              "description": "Update brand configuration"
            },
            {
              "path": "/api/brand/{id}",
              "method": "DELETE",
              "description": "Delete brand configuration"
            }
          ]
        }
      },
      {
        "name": "Research Job Management API",
        "description": "CRUD endpoints for research jobs with Inngest event triggering",
        "files": [
          "src/app/api/research/route.ts",
          "src/app/api/research/[id]/route.ts",
          "src/app/api/research/[id]/status/route.ts",
          "src/types/api.ts"
        ],
        "api_doc": {
          "endpoints": [
            {
              "path": "/api/research",
              "method": "GET",
              "description": "List research jobs with filtering"
            },
            {
              "path": "/api/research",
              "method": "POST",
              "description": "Create research job and trigger Inngest event"
            },
            {
              "path": "/api/research/{id}",
              "method": "GET",
              "description": "Get research job details"
            },
            {
              "path": "/api/research/{id}/status",
              "method": "GET",
              "description": "Poll job status (lightweight endpoint)"
            }
          ]
        }
      },
      {
        "name": "Content Management API",
        "description": "CRUD endpoints for content items generated by agents",
        "files": [
          "src/app/api/content/route.ts",
          "src/types/api.ts"
        ],
        "api_doc": {
          "endpoints": [
            {
              "path": "/api/content",
              "method": "GET",
              "description": "List content items"
            },
            {
              "path": "/api/content",
              "method": "POST",
              "description": "Create content item"
            }
          ]
        }
      },
      {
        "name": "Publishing Queue API",
        "description": "CRUD endpoints for publishing queue with retry logic",
        "files": [
          "src/app/api/publishing/route.ts",
          "src/types/api.ts"
        ],
        "api_doc": {
          "endpoints": [
            {
              "path": "/api/publishing",
              "method": "GET",
              "description": "List publishing queue items"
            },
            {
              "path": "/api/publishing",
              "method": "POST",
              "description": "Create publishing queue item"
            }
          ]
        }
      },
      {
        "name": "TypeScript Type Definitions & Inngest Schemas",
        "description": "Unified type system with Zod validation for all domain models",
        "files": [
          "src/types/research.ts",
          "src/types/content.ts",
          "src/types/events.ts",
          "src/types/db.ts",
          "src/inngest/client.ts"
        ],
        "api_doc": {
          "schemas": [
            {
              "name": "DeepResearchRequestSchema",
              "description": "Validates deep research event payloads",
              "properties": [
                "topic",
                "depth",
                "breadth",
                "userId",
                "sessionId"
              ]
            },
            {
              "name": "CreateBrandSchema",
              "description": "Validates brand creation requests",
              "properties": [
                "name",
                "tovGuidelines",
                "brandColors",
                "logoUrl"
              ]
            }
          ]
        }
      },
      {
        "name": "Testing Infrastructure",
        "description": "Jest configuration with mocks and fixtures for isolated testing",
        "files": [
          "jest.config.js",
          "tests/setup/mock-prisma.ts",
          "tests/setup/mock-inngest.ts",
          "tests/fixtures/brands.ts",
          "playwright.config.ts"
        ],
        "api_doc": {
          "test_utilities": [
            {
              "name": "prismaMock",
              "description": "Mocked Prisma Client for database testing"
            },
            {
              "name": "createMockStep",
              "description": "Factory for mocking Inngest step functions"
            },
            {
              "name": "Fixtures",
              "description": "Pre-built test data for brands, research, content"
            }
          ]
        }
      },
      {
        "name": "Deep Research Agent Orchestrator",
        "description": "Inngest function orchestrating multi-step research workflow with checkpointing and realtime updates",
        "files": [
          "src/inngest/functions/orchestrator.ts",
          "src/inngest/functions/gather-context.ts",
          "src/inngest/channels.ts"
        ],
        "api_doc": {
          "functions": [
            {
              "name": "deep.research.requested",
              "description": "Event trigger for deep research orchestrator",
              "capabilities": [
                "checkpointing",
                "realtime_streaming",
                "job_persistence"
              ]
            },
            {
              "name": "gather-context",
              "description": "Sub-function for collecting research context with depth/breadth parameters"
            }
          ]
        }
      }
    ]
  }
}
